# Session Capture: 2026-02-25 20:30

## Tasks Completed

### UX-33: App-wide cross-links between related records
**Status:** Done
**Files changed:**
- `apps/web/src/app/(dashboard)/business/invoices/[id]/page.tsx` — Client card → clickable Link to `/business/clients/{id}`
- `apps/web/src/app/(dashboard)/business/bills/[id]/page.tsx` — Vendor card → clickable Link to `/business/vendors/{id}`
- `apps/web/src/components/business/PaymentTable.tsx` — Party info → Link to client/vendor detail; allocation doc numbers → Links to invoice/bill detail
- `apps/web/src/app/(dashboard)/accounting/journal-entries/journal-entry-detail.tsx` — Source document → navigable Button linking to original invoice/bill/payment

**Cross-link locations added (5 total):**
1. Invoice detail → Client detail
2. Bill detail → Vendor detail
3. Payment detail → Client/Vendor detail
4. Payment detail → Invoice/Bill detail (allocations)
5. Journal Entry detail → Source document (invoice/bill/payment)

### UX-34: App-wide bulk operations on list pages
**Status:** Done
**Files created:**
- `apps/web/src/hooks/use-bulk-selection.ts` — Generic hook with toggle, toggleAll, clear, isAllSelected, isIndeterminate, count
- `apps/web/src/components/shared/BulkActionToolbar.tsx` — Reusable toolbar with count display, clear button, configurable action buttons

**Files changed:**
- `apps/web/src/components/business/InvoiceTable.tsx` — Added checkbox column, select-all, bulk cancel for DRAFT/SENT invoices
- `apps/web/src/components/business/BillsTable.tsx` — Added checkbox column, select-all, bulk cancel for DRAFT/PENDING bills, fixed date formatting (toLocaleDateString → formatDate)

**Transactions:** Already had full bulk operations (categorize, delete, uncategorize, post-to-GL) — no changes needed.

## Bugs Fixed
- **BillsTable date formatting:** Was using raw `toLocaleDateString()` instead of shared `formatDate()` utility — fixed to use canonical utility

## Errors Encountered & Resolved
- **TS2802: Set iteration error** — `Set<string>` can only be iterated with `--downlevelIteration`. Fixed by wrapping with `Array.from()` before `for...of` loop.

## Patterns Used
- **Cross-link pattern:** `<Link>` with `hover:border-ak-border-2 hover:-translate-y-px` for subtle hover feedback + `ExternalLink` icon appearing on hover via `group-hover:opacity-100`
- **Bulk selection pattern:** Custom hook using `Set<string>` for O(1) lookups, `BulkActionToolbar` with `animate-in slide-in-from-bottom-2` entry animation
- **Checkbox + row click coexistence:** `onClick={(e) => e.stopPropagation()}` on checkbox cell to prevent row navigation on check/uncheck
- **Selected row highlight:** `bg-ak-pri-dim/30` for selected rows

## Self-Reflection Checklist
- [x] All code compiles (0 TS errors)
- [x] Used semantic design tokens (no hardcoded colors)
- [x] Used shared utilities (formatCurrency, formatDate)
- [x] No `: any` types introduced
- [x] Tenant isolation maintained (N/A — frontend only)
- [x] TASKS.md updated with completion status
- [x] Reused existing patterns (EmptyState, BillStatusBadge, InvoiceStatusBadge)

## Artifact Update Hints
- **TASKS.md:** UX-33 ✅, UX-34 ✅ (already updated)
- **MEMORY.md:** Add pattern note about `useBulkSelection` hook + `BulkActionToolbar` component for future bulk operations
