# Session Summary — 2026-02-17 19:30

## What Was Done
- Fixed server/client boundary violation (Invariant #7) in accounting journal-entries page
- Traced root cause: `'use client'` components importing runtime values from `@/lib/api/accounting` → `./client.ts` → `@clerk/nextjs/server` (server-only)
- Fixed 4 client components by redirecting `formatAmount`/`formatDate` imports to client-safe `transactions.types.ts`
- Added `createEntryAction` server action wrapper for `createJournalEntry` in `actions.ts`

## Files Changed
- `apps/web/src/app/(dashboard)/accounting/journal-entries/journal-entries-client.tsx` — import fix
- `apps/web/src/app/(dashboard)/accounting/journal-entries/journal-entry-detail.tsx` — import fix
- `apps/web/src/app/(dashboard)/accounting/journal-entries/journal-entry-form.tsx` — import fix + server action
- `apps/web/src/app/(dashboard)/accounting/journal-entries/actions.ts` — added createEntryAction
- `apps/web/src/app/(dashboard)/accounting/chart-of-accounts/account-row.tsx` — import fix

## Commits Made
- None yet (changes uncommitted)

## Bugs Fixed / Issues Hit
- **Server/Client boundary crash on `/accounting/journal-entries`**
  - **Error:** `'server-only' cannot be imported from a Client Component module`
  - **Root cause:** Import chain: `journal-entries-client.tsx` ('use client') → `@/lib/api/accounting` (formatAmount) → `./client.ts` (apiClient) → `@clerk/nextjs/server` (auth) — server-only module pulled into client bundle
  - **Fix:** Redirect pure utility imports (formatAmount, formatDate) to `@/lib/api/transactions.types.ts` (explicitly client-safe). Wrap `createJournalEntry` API call in a `'use server'` action.
  - **Pattern:** Any client component importing runtime values from `@/lib/api/*.ts` files will hit this because they all chain through `client.ts` which uses `@clerk/nextjs/server`. Only `import type` is safe.

## Patterns Discovered
- **Import chain poison:** `@/lib/api/client.ts` uses `@clerk/nextjs/server`, making ALL `@/lib/api/*.ts` files server-only. Client components MUST NOT import runtime values from these files — only `import type` is safe.
- **Safe alternative:** `@/lib/api/transactions.types.ts` exists as a client-safe module for shared types and formatting utilities.
- **Broader risk:** Any other client component importing non-type values from `@/lib/api/` modules will have the same crash. Should audit all client components for this pattern.

## Unfinished Work
- Changes are uncommitted — need commit
- Should audit ALL client components across the app for the same `@/lib/api/` import chain issue (not just accounting)

## Artifact Update Hints
- MEMORY `debugging-log.md` — add the import chain poison pattern
- MEMORY `codebase-quirks.md` — add note about `@/lib/api/` being server-only
