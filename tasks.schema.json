{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Akount Task Board (v2)",
  "description": "Machine-readable task board with staleness detection, hallucination risk scoring, and claiming support. Generated by .claude/scripts/regenerate-task-index.js",
  "type": "object",
  "required": ["version", "generated", "summary", "tasks", "done", "indexes"],
  "properties": {
    "$schema": { "type": "string" },
    "version": {
      "const": "2.0",
      "description": "Schema version"
    },
    "generated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO timestamp of generation"
    },
    "generatedBy": {
      "type": "string",
      "description": "Script that generated this file"
    },
    "summary": {
      "type": "object",
      "required": ["total", "active", "done", "stale", "riskDistribution"],
      "properties": {
        "total": { "type": "integer", "minimum": 0 },
        "active": { "type": "integer", "minimum": 0 },
        "done": { "type": "integer", "minimum": 0 },
        "stale": { "type": "integer", "minimum": 0, "description": "Tasks past staleness threshold" },
        "riskDistribution": {
          "type": "object",
          "properties": {
            "low": { "type": "integer", "minimum": 0 },
            "medium": { "type": "integer", "minimum": 0 },
            "high": { "type": "integer", "minimum": 0 }
          }
        },
        "byPriority": {
          "type": "object",
          "properties": {
            "critical": { "type": "integer" },
            "high": { "type": "integer" },
            "medium": { "type": "integer" },
            "low": { "type": "integer" }
          }
        },
        "byStatus": {
          "type": "object",
          "properties": {
            "ready": { "type": "integer" },
            "blocked": { "type": "integer" },
            "backlog": { "type": "integer" }
          }
        }
      }
    },
    "agentInstructions": {
      "type": "object",
      "description": "Instructions for AI agents based on risk level",
      "properties": {
        "low": { "type": "string" },
        "medium": { "type": "string" },
        "high": { "type": "string" }
      }
    },
    "tasks": {
      "type": "object",
      "description": "Active tasks keyed by ID",
      "additionalProperties": { "$ref": "#/definitions/task" }
    },
    "done": {
      "type": "object",
      "description": "Completed tasks keyed by ID",
      "additionalProperties": { "$ref": "#/definitions/doneTask" }
    },
    "indexes": {
      "type": "object",
      "description": "Pre-computed indexes for fast lookup",
      "properties": {
        "byDomain": { "type": "object", "additionalProperties": { "type": "array", "items": { "type": "string" } } },
        "byPriority": { "type": "object", "additionalProperties": { "type": "array", "items": { "type": "string" } } },
        "byEffort": { "type": "object", "additionalProperties": { "type": "array", "items": { "type": "string" } } },
        "byStatus": { "type": "object", "additionalProperties": { "type": "array", "items": { "type": "string" } } },
        "quickWins": { "type": "array", "items": { "type": "string" }, "description": "High priority + quick effort + ready" },
        "stale": { "type": "array", "items": { "type": "string" }, "description": "Tasks past staleness threshold" },
        "highRisk": { "type": "array", "items": { "type": "string" }, "description": "Tasks with hallucinationRisk = high" }
      }
    }
  },
  "definitions": {
    "task": {
      "type": "object",
      "required": ["id", "title", "effort", "priority", "status", "domain", "created", "staleness", "hallucinationRisk", "riskScore"],
      "properties": {
        "id": { "type": "string", "pattern": "^[A-Z]+-\\d+[a-z]?$", "description": "Task ID (e.g., SEC-8)" },
        "title": { "type": "string", "description": "Human-readable description" },
        "effort": { "type": "string", "description": "Original effort estimate string (e.g., '2h', '30m')" },
        "effortMinutes": { "type": ["integer", "null"], "description": "Normalized effort in minutes" },
        "effortCategory": { "enum": ["quick", "short", "medium", "long", "unknown"], "description": "Effort bucket" },
        "priority": { "enum": ["critical", "high", "medium", "low", "unknown"] },
        "status": { "enum": ["ready", "blocked", "backlog", "done", "unknown"] },
        "deps": { "type": "array", "items": { "type": "string" }, "description": "Dependency task IDs" },
        "domain": { "type": "string", "description": "Domain category from ID prefix" },
        "source": { "type": "string", "description": "Origin (e.g., 'review:dashboard-overview', 'roadmap', 'manual')" },
        "created": { "type": "string", "format": "date", "description": "Date task was first added (from git blame)" },
        "line": { "type": "integer", "description": "Line number in TASKS.md" },

        "files": { "type": "array", "items": { "type": "string" }, "description": "Affected file paths" },
        "verification": { "type": ["string", "null"], "description": "How to confirm the task is still valid" },
        "acceptanceCriteria": { "type": "array", "items": { "type": "string" }, "description": "Conditions for done" },
        "lastVerified": { "type": ["string", "null"], "format": "date", "description": "Last verification date (resets staleness clock)" },
        "sourceRef": { "type": ["string", "null"], "description": "Link to review SUMMARY.md" },
        "externalId": { "type": ["string", "null"], "description": "ID in external system for bidirectional sync" },
        "tags": { "type": "array", "items": { "type": "string" }, "description": "Labels (e.g., dashboard, security)" },
        "notes": { "type": ["string", "null"], "description": "Free-form context for the executor" },

        "staleness": {
          "type": "object",
          "required": ["isStale", "daysSinceVerified", "staleAfterDays", "recommendation"],
          "properties": {
            "isStale": { "type": "boolean" },
            "daysSinceVerified": { "type": "integer", "minimum": 0 },
            "staleAfterDays": { "type": "integer", "minimum": 1 },
            "recommendation": { "enum": ["ok", "verify_before_executing"] }
          }
        },
        "hallucinationRisk": { "enum": ["low", "medium", "high"] },
        "riskScore": { "type": "integer", "minimum": 0, "maximum": 10 },
        "riskFactors": {
          "type": "array",
          "items": { "enum": ["age_stale", "no_files", "vague_title", "large_effort", "no_acceptance_criteria", "source_unspecific"] }
        },
        "claimed": { "type": "boolean", "description": "Whether an agent has claimed this task" },
        "claimedBy": { "type": ["string", "null"], "description": "Agent session ID if claimed" }
      }
    },
    "doneTask": {
      "type": "object",
      "required": ["id", "title"],
      "properties": {
        "id": { "type": "string" },
        "title": { "type": "string" },
        "domain": { "type": "string" },
        "source": { "type": "string" },
        "completedAt": { "type": ["string", "null"], "format": "date" },
        "completedCommit": { "type": ["string", "null"] }
      }
    }
  }
}
